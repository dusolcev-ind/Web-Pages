<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global EV Taxi Ledger: Subsidies & Risk Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 
    Chosen Palette: "Energetic & Playful"
    Primary: #0ea5e9 (Sky-500)
    Secondary: #6366f1 (Indigo-500)
    Accent: #f43f5e (Rose-500)
    Background: #f8fafc (Slate-50)
    -->

    <style>
        body { background-color: #f8fafc; color: #0f172a; font-family: sans-serif; }
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #e2e8f0; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        
        /* Badge Styles for Subsidy Types */
        .badge-cash { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; } /* Green */
        .badge-tax { background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; } /* Blue */
        .badge-exempt { background-color: #ffedd5; color: #9a3412; border: 1px solid #fed7aa; } /* Orange */
        
        .score-circle {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 0.9rem;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Sticky Header -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-3">
                    <span class="text-3xl">ðŸ”‹</span>
                    <div>
                        <h1 class="font-black text-xl tracking-tight text-slate-800 uppercase">EV Taxi <span class="text-sky-600">Master Ledger</span></h1>
                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Updated with Fiscal Policy & Scrappage Schemes</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full bg-emerald-100 border border-emerald-300"></span>
                        <span class="text-xs font-bold text-slate-500">Direct Cash</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full bg-blue-100 border border-blue-300"></span>
                        <span class="text-xs font-bold text-slate-500">Tax Breaks</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

        <!-- Top Level Insights -->
        <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Insight 1 -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 border-l-4 border-sky-500">
                <h3 class="text-sky-600 font-bold text-xs uppercase tracking-widest mb-1">Fiscal Leader</h3>
                <div class="flex justify-between items-end">
                    <div>
                        <div class="text-2xl font-black text-slate-900">Thailand</div>
                        <div class="text-xs text-slate-500">EV 3.5 Package</div>
                    </div>
                    <div class="text-3xl font-black text-sky-200">9.2</div>
                </div>
                <p class="mt-3 text-sm text-slate-600">The only market offering substantial <strong>Direct Cash Subsidies</strong> (up to 100k THB) alongside duty cuts.</p>
            </div>

            <!-- Insight 2 -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 border-l-4 border-indigo-500">
                <h3 class="text-indigo-600 font-bold text-xs uppercase tracking-widest mb-1">Tax Arbitrage King</h3>
                <div class="flex justify-between items-end">
                    <div>
                        <div class="text-2xl font-black text-slate-900">Nepal</div>
                        <div class="text-xs text-slate-500">Duty Differential</div>
                    </div>
                    <div class="text-3xl font-black text-indigo-200">8.9</div>
                </div>
                <p class="mt-3 text-sm text-slate-600">ICE vehicles pay ~250% tax. EVs pay ~10%. This creates a <strong>50% retail price discount</strong> relative to gas cars.</p>
            </div>

            <!-- Insight 3 (User Request Focus) -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 border-l-4 border-rose-500">
                <h3 class="text-rose-600 font-bold text-xs uppercase tracking-widest mb-1">Policy Mover</h3>
                <div class="flex justify-between items-end">
                    <div>
                        <div class="text-2xl font-black text-slate-900">Peru</div>
                        <div class="text-xs text-slate-500">MTC Scrappage Norms</div>
                    </div>
                    <div class="text-3xl font-black text-rose-200">7.2</div>
                </div>
                <p class="mt-3 text-sm text-slate-600">New scoring reflects "Bono del Chatarreo" and MTC norms promoting fleet renewal.</p>
            </div>
        </section>

        <!-- Ranking Chart -->
        <section class="bg-white p-8 rounded-3xl shadow-lg border border-slate-100">
            <div class="mb-6">
                <h3 class="text-lg font-bold text-slate-900">Global Subsidy & Opportunity Impact Score</h3>
                <p class="text-sm text-slate-500">Aggregated score (1-10) factoring in Cash Subsidies (40%), Tax Relief (30%), and Infra (30%).</p>
            </div>
            <div class="chart-container">
                <canvas id="scoreChart"></canvas>
            </div>
        </section>

        <!-- The Master Ledger -->
        <section class="space-y-4">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <h2 class="text-2xl font-black text-slate-900">Strategic Research Ledger</h2>
                <input type="text" id="searchInput" placeholder="Search subsidies, countries, risks..." class="w-full md:w-96 px-4 py-3 rounded-xl border border-slate-300 shadow-sm focus:ring-2 focus:ring-sky-500 outline-none text-sm">
            </div>

            <div class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-wider">Country</th>
                                <th class="px-6 py-4 text-left text-xs font-black text-sky-600 uppercase tracking-wider bg-sky-50">Subsidies & Fiscal Incentives</th>
                                <th class="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-wider">Opportunities (Ops & Regs)</th>
                                <th class="px-6 py-4 text-left text-xs font-black text-slate-500 uppercase tracking-wider">Risks</th>
                                <th class="px-6 py-4 text-center text-xs font-black text-slate-500 uppercase tracking-wider">Score</th>
                                <th class="px-6 py-4 text-center text-xs font-black text-slate-500 uppercase tracking-wider">Share</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200" id="ledgerBody">
                            <!-- JS Injection -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-slate-900 py-12 text-center mt-12">
        <p class="text-slate-500 text-xs uppercase tracking-widest">Internal Strategic Resource â€¢ EV Fleet Planning Group</p>
        <p class="text-slate-600 text-[10px] mt-2">Data sourced from Ministry of Transport decrees (Peru MTC, Thailand BOI, etc.) valid as of Q1 2025.</p>
    </footer>

    <script>
        // --- DATASET ---
        const countryData = [
            {
                name: "Thailand",
                region: "SEA",
                subsidy: "CASH: 50k-100k THB per vehicle. TAX: Excise tax cut from 8% to 2%. Import duty reduced to 0% (if local manufacturing committed).",
                type: "cash",
                opps: "EV 3.5 is the most aggressive policy in SEA. Massive Chinese OEM presence (BYD, Aion, GWM) guarantees supply of cheap mass-market units.",
                risks: "Charging bottlenecks in older Bangkok residential zones. High electricity demand charges for fast-charging depots.",
                score: 9.2,
                share: "8.5%"
            },
            {
                name: "Nepal",
                region: "SEA/S.Asia",
                subsidy: "TAX ARBITRAGE: Customs duty ~10% for EV vs ~80-250% for ICE. No annual road tax (or extremely minimal).",
                type: "tax",
                opps: "The tax gap is so large that EVs are cheaper to buy upfront than gas cars. Domestic hydro-power makes 'fuel' virtually free.",
                risks: "Extreme terrain challenges for entry-level EV motors. Single-border logistics reliance (India).",
                score: 8.9,
                share: "10%"
            },
            {
                name: "Vietnam",
                region: "SEA",
                subsidy: "EXEMPTION: 0% Registration Fee (LPT) (saves 10-12% of car value). Reduced Special Consumption Tax (3% vs ~50%).",
                type: "exempt",
                opps: "VinFast vertical integration (Taxi GSM) provides turnkey fleet solutions. Strong government push for green transport.",
                risks: "VinFast monopoly limits price discovery. Grid stability in the North during dry seasons.",
                score: 8.6,
                share: "12%"
            },
            {
                name: "Colombia",
                region: "LATAM",
                subsidy: "TAX: 5% VAT (vs 19%). 0% Tariff. SCRAPPAGE: 'Bono de ChatarrizaciÃ³n' funds available for modernizing taxi fleets.",
                type: "tax",
                opps: "Exemption from 'Pico y Placa' is a massive revenue booster (20% more uptime). Bogota has mature electric bus infra to leverage.",
                risks: "Mountainous topography creates range anxiety. Depreciation of the COP currency impacts import costs.",
                score: 8.4,
                share: "3.5%"
            },
            {
                name: "Jordan",
                region: "MENA",
                subsidy: "TAX: 10% Special Tax on EV vs ~90% on Hybrid/ICE. (Note: Recent discussions on raising EV tax to 15% still leave a huge gap).",
                type: "tax",
                opps: "High fuel prices drive organic demand. The market is flooded with affordable Chinese imports via gray market channels.",
                risks: "Gray market dominance means poor after-sales support and warranty voids. Battery disposal regulations are weak.",
                score: 8.1,
                share: "16%"
            },
            {
                name: "Indonesia",
                region: "SEA",
                subsidy: "TAX: VAT reduced from 11% to 1% (effectively a 10% discount). Luxury tax exemption.",
                type: "tax",
                opps: "Local Nickel supply chain promises future battery cost reductions. 'Ganjil-Genap' (Odd-Even) traffic exemption in Jakarta.",
                risks: "Subsidy requires 40% local content, limiting model choice to Wuling/Hyundai. Charging infra is Jakarta-centric.",
                score: 7.9,
                share: "1.5%"
            },
            {
                name: "Mexico",
                region: "LATAM",
                subsidy: "EXEMPTION: 0% ISAN (New Car Tax). 0% Import Duty (extended). Income tax deductibility up to 250k MXN.",
                type: "exempt",
                opps: "'Hoy No Circula' exemption guarantees uptime. Massive influx of cheap Chinese brands (BYD, JAC, SEV).",
                risks: "Lack of federal cash subsidy. Public charging security issues in certain states.",
                score: 7.5,
                share: "1.2%"
            },
            {
                name: "Morocco",
                region: "MENA",
                subsidy: "TAX: Green incentives include VAT exemption/reduction. No Luxury Tax.",
                type: "exempt",
                opps: "Stable renewable grid (40% green energy) supports ESG branding. Proximity to EU manufacturing standards.",
                risks: "Conservative market prefers Dacia diesels due to reliability perception. Fast charging is sparse.",
                score: 7.3,
                share: "1.5%"
            },
            {
                name: "Peru",
                region: "LATAM",
                subsidy: "SCRAPPAGE: 'Bono del Chatarreo' (MTC 2025 norms) incentives for fleet renewal. TAX: IGV (Sales Tax) benefits debated/applied selectively.",
                type: "cash",
                opps: "Low electricity costs. New regulations (MTC-18) specifically target taxi modernization, creating a legal framework for EV transition.",
                risks: "Political volatility often stalls policy implementation. Infrastructure is almost entirely private sector led.",
                score: 7.2,
                share: "<1%"
            },
            {
                name: "Brazil",
                region: "LATAM",
                subsidy: "MIXED: 'Mover' program incentivizes local production. Sao Paulo offers IPVA (Road Tax) refund/exemption.",
                type: "tax",
                opps: "Huge market scale. Uber 'Green' active in Sao Paulo.",
                risks: "Import taxes on EVs are *increasing* (back to 35%) to protect local Ethanol/Flex-fuel industry. This hurts cheap EV imports.",
                score: 6.8,
                share: "1.5%"
            },
            {
                name: "Philippines",
                region: "SEA",
                subsidy: "EXEMPTION: E-VIDA Law guarantees 0% Import Duty and Excise Tax exemption.",
                type: "exempt",
                opps: "Priority registration 'Green Lanes'. Strong push for modernizing Jeepneys can spill over to Taxis.",
                risks: "Highest electricity cost in the region ($0.18/kWh) eats into OPEX savings. Grid instability.",
                score: 6.6,
                share: "<0.5%"
            },
            {
                name: "UAE",
                region: "MENA",
                subsidy: "OPERATIONAL: No purchase subsidy. Free Salik (Tolls), Free Parking, Free Registration.",
                type: "exempt",
                opps: "RTA mandates 100% hybrid/electric taxi fleet by 2027. World-class infrastructure.",
                risks: "Low petrol prices reduce the 'pain' of ICE ownership. High heat reduces real-world range significantly.",
                score: 6.5,
                share: "5%"
            },
            {
                name: "Egypt",
                region: "MENA",
                subsidy: "SCRAPPAGE: 'Green Taxi' initiative offers ~50k EGP for replacing old cars. Custom duty exemptions.",
                type: "cash",
                opps: "High population density ideal for ride-hailing. Government desperate to reduce fuel subsidy bill.",
                risks: "Subsidized fuel makes ICE OPEX artificially low. Currency devaluation makes imported EVs expensive.",
                score: 5.5,
                share: "<0.5%"
            },
            {
                name: "Saudi Arabia",
                region: "MENA",
                subsidy: "NONE: Focus is on infrastructure build-out (EVIQ) and local manufacturing (Ceer).",
                type: "none",
                opps: "Vision 2030 capital availability. Massive potential for corporate fleets.",
                risks: "Cheap gasoline ($0.62/L). No incentives to bridge the CAPEX gap yet.",
                score: 5.0,
                share: "<0.2%"
            },
            {
                name: "Pakistan",
                region: "S.Asia",
                subsidy: "TAX: 1% GST on locally manufactured EVs. Import duty cuts on parts.",
                type: "tax",
                opps: "Inflationary fuel prices create desperation for alternatives.",
                risks: "Macro-economic crisis. Grid load-shedding makes charging unreliable. Import restrictions.",
                score: 3.8,
                share: "<0.1%"
            }
        ];

        // --- RENDER TABLE ---
        const tableBody = document.getElementById('ledgerBody');
        const searchInput = document.getElementById('searchInput');

        function renderLedger(data) {
            tableBody.innerHTML = '';
            data.forEach(item => {
                let badgeClass = '';
                let typeLabel = '';
                
                switch(item.type) {
                    case 'cash': 
                        badgeClass = 'badge-cash'; 
                        typeLabel = 'CASH / SCRAPPAGE';
                        break;
                    case 'tax': 
                        badgeClass = 'badge-tax'; 
                        typeLabel = 'TAX BREAK';
                        break;
                    case 'exempt': 
                        badgeClass = 'badge-exempt'; 
                        typeLabel = 'EXEMPTION';
                        break;
                    default:
                        badgeClass = 'bg-slate-100 text-slate-500 border-slate-200';
                        typeLabel = 'NONE/LOW';
                }

                const scoreColor = item.score >= 8 ? 'bg-sky-100 text-sky-700' : 
                                  item.score >= 6 ? 'bg-indigo-50 text-indigo-700' : 
                                  'bg-slate-100 text-slate-600';

                const row = `
                    <tr class="hover:bg-slate-50 transition-colors group">
                        <td class="px-6 py-5 align-top">
                            <div class="font-bold text-slate-900 text-sm">${item.name}</div>
                            <div class="text-[10px] font-bold text-slate-400 uppercase mt-1">${item.region}</div>
                        </td>
                        <td class="px-6 py-5 align-top bg-sky-50/30 group-hover:bg-sky-50 transition-colors">
                            <span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold mb-2 ${badgeClass}">${typeLabel}</span>
                            <p class="text-xs text-slate-700 leading-relaxed font-medium">${item.subsidy}</p>
                        </td>
                        <td class="px-6 py-5 align-top text-xs text-slate-600 leading-relaxed max-w-xs">
                            ${item.opps}
                        </td>
                        <td class="px-6 py-5 align-top text-xs text-slate-500 leading-relaxed max-w-xs">
                            ${item.risks}
                        </td>
                        <td class="px-6 py-5 align-top">
                            <div class="score-circle mx-auto ${scoreColor}">${item.score}</div>
                        </td>
                        <td class="px-6 py-5 align-top text-center text-xs font-bold text-slate-700">
                            ${item.share}
                        </td>
                    </tr>
                `;
                tableBody.insertAdjacentHTML('beforeend', row);
            });
        }

        renderLedger(countryData);

        // --- SEARCH ---
        searchInput.addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase();
            const filtered = countryData.filter(c => 
                c.name.toLowerCase().includes(q) || 
                c.subsidy.toLowerCase().includes(q) ||
                c.type.toLowerCase().includes(q)
            );
            renderLedger(filtered);
        });

        // --- CHART ---
        const ctx = document.getElementById('scoreChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: countryData.map(c => c.name),
                datasets: [{
                    label: 'Feasibility Score',
                    data: countryData.map(c => c.score),
                    backgroundColor: countryData.map(c => {
                        if (c.score >= 8.5) return '#0ea5e9'; // Sky
                        if (c.score >= 7.0) return '#6366f1'; // Indigo
                        if (c.score >= 5.0) return '#cbd5e1'; // Slate
                        return '#f43f5e'; // Rose
                    }),
                    borderRadius: 8,
                    barThickness: 30
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#1e293b',
                        callbacks: {
                            afterLabel: function(context) {
                                return "Subsidy: " + countryData[context.dataIndex].type.toUpperCase();
                            }
                        }
                    }
                },
                scales: {
                    y: { beginAtZero: true, max: 10, grid: { color: '#f1f5f9' } },
                    x: { grid: { display: false }, ticks: { font: { size: 10, weight: 'bold' } } }
                }
            }
        });
    </script>
</body>
</html>
